---
  - name: Getting {{resource_group_name}} resource group facts
    azure_rm_resourcegroup_facts:
      client_id: "{{azure_client_id}}"
      secret: "{{azure_secret}}"
      tenant: "{{azure_tenant}}"
      subscription_id: "{{azure_subscription}}"
      name: "{{resource_group_name}}"
    register: resource_group

  - block:
    - name: Getting {{virtual_network_name}} facts
      azure_rm_virtualnetwork_facts:
        client_id: "{{azure_client_id}}"
        secret: "{{azure_secret}}"
        tenant: "{{azure_tenant}}"
        subscription_id: "{{azure_subscription}}"
        resource_group: "{{resource_group_name}}"
        name: "{{virtual_network_name}}"
      register: virtual_network

    - block:
      - include_tasks: down_public.yml
      - include_tasks: down_private.yml
      when: virtual_network.ansible_facts.azure_virtualnetworks|length > 0

    - name: Destroy {{virtual_network_name}} virtual network
      azure_rm_virtualnetwork:
        client_id: "{{azure_client_id}}"
        secret: "{{azure_secret}}"
        tenant: "{{azure_tenant}}"
        subscription_id: "{{azure_subscription}}"
        resource_group: "{{resource_group_name}}"
        name: "{{virtual_network_name}}"
        state: absent
    when: resource_group.ansible_facts.azure_resourcegroups|length > 0
