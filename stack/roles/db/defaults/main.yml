---
rpm: "https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-centos10-10-2.noarch.rpm"
version: "10.2"
major: "{{version.split('.')[0]}}"
user: "postgres"

packages:
  - "postgresql{{major}}-server"
  - "python-psycopg2"

databases:
  - { name: "{{db_dvdrental}}", owner: "{{db_dvdrental_admin}}" }
  - { name: "{{db_fof}}", owner: "{{db_fof_admin}}" }

hba:
  - { type: "local", database: "all", user: "{{user}}", auth_method: "peer"}
  - { type: "host", database: "{{db_dvdrental}}", user: "{{db_dvdrental_admin}}", address: "127.0.0.1/32", auth_method: "md5" }
  - { type: "host", database: "{{db_dvdrental}}", user: "{{db_dvdrental_user}}", address: "127.0.0.1/32", auth_method: "md5" }
  - { type: "host", database: "{{db_fof}}", user: "{{db_fof_admin}}", address: "127.0.0.1/32", auth_method: "md5" }
  - { type: "host", database: "{{db_fof}}", user: "{{db_fof_user}}", address: "127.0.0.1/32", auth_method: "md5" }

users:
  - { user: "{{db_dvdrental_admin}}", password: "{{db_dvdrental_admin_password}}" }
  - { user: "{{db_dvdrental_user}}", password: "{{db_dvdrental_user_password}}" }
  - { user: "{{db_fof_admin}}", password: "{{db_fof_admin_password}}" }
  - { user: "{{db_fof_user}}", password: "{{db_fof_user_password}}" }

privs:
  - { database: "{{db_dvdrental}}", roles: "{{db_dvdrental_user}}", grant: "no", privs: "SELECT,INSERT,UPDATE,DELETE,CONNECT"}
  - { database: "{{db_fof}}", roles: "{{db_fof_user}}", grant: "no", privs: "SELECT,INSERT,UPDATE,DELETE,CONNECT"}